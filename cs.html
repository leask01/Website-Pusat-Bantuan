<!DOCTYPE html>
<html lang="id" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Form Pengaduan Konsumen | PT Bungsu Mandiri Nawasena</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <style>
        body { font-family: 'Inter', sans-serif; }
        textarea::-webkit-scrollbar { width: 8px; }
        textarea::-webkit-scrollbar-track { background: #f1f5f9; rounded: 8px; }
        textarea::-webkit-scrollbar-thumb { background: #cbd5e1; rounded: 8px; }
        textarea::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 antialiased min-h-screen flex flex-col">

    <nav class="bg-white border-b border-gray-200 sticky top-0 z-50 shadow-sm">
        <div class="max-w-3xl mx-auto px-4 sm:px-6 h-16 flex items-center justify-between">
            <div class="flex items-center gap-3">
                <div class="bg-slate-900 w-8 h-8 rounded flex items-center justify-center text-white border-b-2 border-[#ffa600]">
                    <i class="fas fa-headset text-sm"></i>
                </div>
                <span class="font-bold text-slate-900 tracking-tight">Pusat Bantuan BMN</span>
            </div>
            <a href="index.html" class="text-sm font-semibold text-gray-500 hover:text-slate-900 flex items-center gap-2 transition-colors">
                <i class="fas fa-arrow-left"></i> <span class="hidden sm:inline">Kembali</span>
            </a>
        </div>
    </nav>

    <main class="flex-grow py-8 px-4 sm:px-6">
        <div class="max-w-3xl mx-auto">
            
            <div class="mb-8 text-center sm:text-left">
                <h1 class="text-2xl sm:text-3xl font-bold text-slate-900 mb-2">Form Keluhan Konsumen</h1>
                <p class="text-gray-500 text-sm">Silakan lengkapi data di bawah ini. Tim lapangan kami akan segera menindaklanjuti laporan Anda.</p>
            </div>

            <div class="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden">
                <form id="complaintForm" class="p-6 sm:p-8 space-y-8" onsubmit="event.preventDefault(); submitToSupabase();">
                    
                    <section>
                        <h2 class="text-sm font-bold text-slate-900 uppercase tracking-wider mb-4 border-b pb-2 flex items-center gap-2">
                            <i class="fas fa-user text-[#ffa600]"></i> Data Pelapor
                        </h2>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-1">Nama Konsumen <span class="text-red-500">*</span></label>
                                <input type="text" id="nama_konsumen" required placeholder="Sesuai nama pemilik" class="w-full px-4 py-2.5 rounded-lg border border-gray-300 focus:ring-2 focus:ring-[#ffa600] focus:border-[#ffa600] outline-none transition bg-slate-50 focus:bg-white text-sm">
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-1">Nomor WA <span class="text-red-500">*</span></label>
                                <input type="tel" id="no_wa" required placeholder="08xxxxxxxxxx" class="w-full px-4 py-2.5 rounded-lg border border-gray-300 focus:ring-2 focus:ring-[#ffa600] focus:border-[#ffa600] outline-none transition bg-slate-50 focus:bg-white text-sm">
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-1">Pilih Project <span class="text-red-500">*</span></label>
                                <select id="project" required class="w-full px-4 py-2.5 rounded-lg border border-gray-300 focus:ring-2 focus:ring-[#ffa600] focus:border-[#ffa600] outline-none transition bg-slate-50 focus:bg-white text-sm cursor-pointer">
                                    <option value="" disabled selected>Pilih Lokasi Cluster...</option>
                                    <option value="Cluster A">Cluster A - Scandinavian</option>
                                    <option value="Cluster B">Cluster B - Tropical</option>
                                    <option value="Lainnya">Lainnya</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-1">Blok / Nomor Unit <span class="text-red-500">*</span></label>
                                <input type="text" id="unit" required placeholder="Contoh: A2 No. 15" class="w-full px-4 py-2.5 rounded-lg border border-gray-300 focus:ring-2 focus:ring-[#ffa600] focus:border-[#ffa600] outline-none transition bg-slate-50 focus:bg-white text-sm">
                            </div>
                            <div class="md:col-span-2">
                                <label class="block text-sm font-semibold text-gray-700 mb-1">Tanggal Serah Terima Rumah (BAST) <span class="text-red-500">*</span></label>
                                <input type="date" id="tgl_serah_terima" required class="w-full px-4 py-2.5 rounded-lg border border-gray-300 focus:ring-2 focus:ring-[#ffa600] focus:border-[#ffa600] outline-none transition bg-slate-50 focus:bg-white text-sm cursor-pointer">
                            </div>
                        </div>
                    </section>

                    <section>
                        <h2 class="text-sm font-bold text-slate-900 uppercase tracking-wider mb-4 border-b pb-2 flex items-center gap-2">
                            <i class="fas fa-tools text-[#ffa600]"></i> Detail Keluhan
                        </h2>
                        <label class="block text-sm font-semibold text-gray-700 mb-3">Jenis Keluhan (Pilih Salah Satu) <span class="text-red-500">*</span></label>
                        
                        <div class="grid grid-cols-2 sm:grid-cols-3 gap-3">
                            <label class="cursor-pointer">
                                <input type="radio" name="jenis_keluhan" value="Bangunan" class="peer hidden" required>
                                <div class="p-3 border-2 border-gray-200 rounded-lg peer-checked:border-[#ffa600] peer-checked:bg-yellow-50 hover:bg-slate-50 transition flex flex-col items-center text-center gap-2">
                                    <i class="fas fa-home text-gray-400 peer-checked:text-[#ffa600] text-xl"></i>
                                    <span class="text-xs font-semibold text-gray-600 peer-checked:text-slate-900">Bangunan</span>
                                </div>
                            </label>
                            <label class="cursor-pointer">
                                <input type="radio" name="jenis_keluhan" value="Plumbing" class="peer hidden">
                                <div class="p-3 border-2 border-gray-200 rounded-lg peer-checked:border-[#ffa600] peer-checked:bg-yellow-50 hover:bg-slate-50 transition flex flex-col items-center text-center gap-2">
                                    <i class="fas fa-faucet text-gray-400 peer-checked:text-[#ffa600] text-xl"></i>
                                    <span class="text-xs font-semibold text-gray-600 peer-checked:text-slate-900">Plumbing</span>
                                </div>
                            </label>
                            <label class="cursor-pointer">
                                <input type="radio" name="jenis_keluhan" value="Kelistrikan" class="peer hidden">
                                <div class="p-3 border-2 border-gray-200 rounded-lg peer-checked:border-[#ffa600] peer-checked:bg-yellow-50 hover:bg-slate-50 transition flex flex-col items-center text-center gap-2">
                                    <i class="fas fa-bolt text-gray-400 peer-checked:text-[#ffa600] text-xl"></i>
                                    <span class="text-xs font-semibold text-gray-600 peer-checked:text-slate-900">Kelistrikan</span>
                                </div>
                            </label>
                            <label class="cursor-pointer">
                                <input type="radio" name="jenis_keluhan" value="Lingkungan" class="peer hidden">
                                <div class="p-3 border-2 border-gray-200 rounded-lg peer-checked:border-[#ffa600] peer-checked:bg-yellow-50 hover:bg-slate-50 transition flex flex-col items-center text-center gap-2">
                                    <i class="fas fa-road text-gray-400 peer-checked:text-[#ffa600] text-xl"></i>
                                    <span class="text-xs font-semibold text-gray-600 peer-checked:text-slate-900">Lingkungan</span>
                                </div>
                            </label>
                            <label class="cursor-pointer">
                                <input type="radio" name="jenis_keluhan" value="Legalitas" class="peer hidden">
                                <div class="p-3 border-2 border-gray-200 rounded-lg peer-checked:border-[#ffa600] peer-checked:bg-yellow-50 hover:bg-slate-50 transition flex flex-col items-center text-center gap-2">
                                    <i class="fas fa-file-signature text-gray-400 peer-checked:text-[#ffa600] text-xl"></i>
                                    <span class="text-xs font-semibold text-gray-600 peer-checked:text-slate-900">Legalitas</span>
                                </div>
                            </label>
                            <label class="cursor-pointer">
                                <input type="radio" name="jenis_keluhan" value="Lainnya" class="peer hidden">
                                <div class="p-3 border-2 border-gray-200 rounded-lg peer-checked:border-[#ffa600] peer-checked:bg-yellow-50 hover:bg-slate-50 transition flex flex-col items-center text-center gap-2">
                                    <i class="fas fa-ellipsis-h text-gray-400 peer-checked:text-[#ffa600] text-xl"></i>
                                    <span class="text-xs font-semibold text-gray-600 peer-checked:text-slate-900">Lainnya</span>
                                </div>
                            </label>
                        </div>

                        <div class="mt-5">
                            <label class="block text-sm font-semibold text-gray-700 mb-1">Detail Keluhan <span class="text-red-500">*</span></label>
                            <textarea id="detail_keluhan" required rows="4" placeholder="Jelaskan secara detail masalah yang Anda alami..." class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-[#ffa600] focus:border-[#ffa600] outline-none transition bg-slate-50 focus:bg-white text-sm resize-y"></textarea>
                        </div>

                        <div class="mt-5">
                            <label class="block text-sm font-semibold text-gray-700 mb-1">Lampirkan Foto (Opsional)</label>
                            <p class="text-xs text-gray-500 mb-2">Bantu tim kami memahami kerusakan dengan melampirkan foto area terkait.</p>
                            <input type="file" id="foto_lampiran" accept="image/*" capture="environment" class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-xs file:font-bold file:bg-[#ffa600]/10 file:text-[#ffa600] hover:file:bg-[#ffa600]/20 cursor-pointer transition">
                        </div>
                    </section>

                    <div class="pt-4 border-t border-gray-100">
                        <button type="submit" id="submitBtn" class="w-full bg-slate-900 text-white font-bold py-3.5 rounded-lg shadow-lg hover:bg-[#ffa600] hover:text-slate-900 transition-colors flex items-center justify-center gap-2">
                            <i class="fas fa-paper-plane"></i> Kirim Laporan
                        </button>
                        <p class="text-[10px] text-center text-gray-400 mt-3">
                            Dengan mengirimkan form ini, Anda menyetujui jadwal pengecekan dari tim teknis PT Bungsu Mandiri Nawasena.
                        </p>
                    </div>
                </form>
            </div>
        </div>
    </main>

    <div id="successModal" class="fixed inset-0 bg-slate-900/50 backdrop-blur-sm z-50 hidden flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl p-8 max-w-sm w-full text-center transform scale-95 opacity-0 transition-all duration-300" id="modalContent">
            <div class="w-16 h-16 bg-green-100 text-green-500 rounded-full flex items-center justify-center text-3xl mx-auto mb-4">
                <i class="fas fa-check"></i>
            </div>
            <h3 class="text-xl font-bold text-slate-900 mb-2">Laporan Terkirim!</h3>
            <p class="text-sm text-gray-500 mb-6">Terima kasih. Laporan Anda telah masuk ke sistem kami dan akan segera divalidasi oleh tim lapangan.</p>
            <button onclick="closeModal()" class="w-full bg-slate-100 text-slate-900 font-bold py-2.5 rounded-lg hover:bg-slate-200 transition">
                Tutup & Kembali
            </button>
        </div>
    </div>

    <script>
        // 1. Inisialisasi Supabase (GANTI URL DAN KEY INI)
        const supabaseUrl = 'https://wjmilsczkzoyijfrghmc.supabase.co'
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndqbWlsc2N6a3pveWlqZnJnaG1jIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjYyMzIyNzQsImV4cCI6MjA4MTgwODI3NH0.-CXQ_HKRS23MX5mBwQVbaFlsOOlFjywMGPEJqWXXM2s'  
        // Variabel supabase diganti jadi 'sb' sesuai standar lu bre
        const sb = window.supabase.createClient(supabaseUrl, supabaseKey);

        async function submitToSupabase() {
            // Ambil tombol buat dikasih efek loading
            const btn = document.getElementById('submitBtn');
            const originalBtnText = btn.innerHTML;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Mengirim...';
            btn.disabled = true;
            btn.classList.add('opacity-70', 'cursor-not-allowed');

            // Tangkap semua data dari form
            const nama_konsumen = document.getElementById('nama_konsumen').value;
            const no_wa = document.getElementById('no_wa').value;
            const project = document.getElementById('project').value;
            const unit = document.getElementById('unit').value;
            const tgl_serah_terima = document.getElementById('tgl_serah_terima').value;
            const detail_keluhan = document.getElementById('detail_keluhan').value;
            
            // Tangkap value radio button yang dipilih
            const jenis_keluhan_element = document.querySelector('input[name="jenis_keluhan"]:checked');
            const jenis_keluhan = jenis_keluhan_element ? jenis_keluhan_element.value : '';

            // 2. Insert ke tabel Supabase MENGGUNAKAN 'sb'
            const { data, error } = await sb
                .from('pengaduan_konsumen')
                .insert([
                    {
                        nama_konsumen: nama_konsumen,
                        no_wa: no_wa,
                        project: project,
                        unit: unit,
                        tgl_serah_terima: tgl_serah_terima,
                        jenis_keluhan: jenis_keluhan,
                        detail_keluhan: detail_keluhan,
                        status: 'Pending' // Default status saat pertama kali masuk
                    }
                ]);

            // Kembalikan tombol seperti semula
            btn.innerHTML = originalBtnText;
            btn.disabled = false;
            btn.classList.remove('opacity-70', 'cursor-not-allowed');

            // Cek apakah ada error dari Supabase
            if (error) {
                console.error('Error insert data:', error);
                alert('Gagal mengirim laporan. Pastikan koneksi internet lancar atau hubungi admin. Error: ' + error.message);
            } else {
                // Kalo sukses, tampilin modal success
                showSuccessModal();
            }
        }

        function showSuccessModal() {
            const modal = document.getElementById('successModal');
            const modalContent = document.getElementById('modalContent');
            
            modal.classList.remove('hidden');
            setTimeout(() => {
                modalContent.classList.remove('scale-95', 'opacity-0');
                modalContent.classList.add('scale-100', 'opacity-100');
            }, 10);
        }

        function closeModal() {
            document.getElementById('complaintForm').reset();
            const modal = document.getElementById('successModal');
            const modalContent = document.getElementById('modalContent');
            
            modalContent.classList.remove('scale-100', 'opacity-100');
            modalContent.classList.add('scale-95', 'opacity-0');
            
            setTimeout(() => {
                modal.classList.add('hidden');
                window.scrollTo(0, 0);
            }, 300);
        }
    </script>
</body>
</html>